<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Click-to-Advance Slideshow — Crossfade, Images + WebM</title>
  <style>
    :root { --bg: #7e5e7c; --fg: #222; --muted: #6a6a6a; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow: hidden;
    }

    .stage { position: fixed; inset: 0; display: grid; place-items: center; cursor: pointer; user-select: none; }
    .stack { position: relative; width: 100vw; height: 100vh; }

    .slide { position: absolute; inset: 0; margin: auto; display: grid; place-items: center; opacity: 0; transition: opacity 350ms ease; }
    .slide.is-visible { opacity: 1; }

    .media { display: block; pointer-events: none; }
    .media::-webkit-media-controls { display: none !important; }

    .overlay { position: fixed; left: 50%; bottom: 12px; transform: translateX(-50%); font-size: 12px; color: var(--muted); background: rgba(0,0,0,0.08); padding: 6px 10px; border-radius: 10px; backdrop-filter: blur(2px); }

    .home { position: fixed; left: 12px; bottom: 12px; z-index: 20; padding: 6px 10px; border-radius: 10px; border: 1px solid rgba(0,0,0,0.15); background: rgba(255,255,255,0.7); color: #111; font-size: 16px; backdrop-filter: blur(2px); cursor: pointer; user-select: none; transition: opacity 200ms ease; }
    .home:hover { background: rgba(255,255,255,0.9); }
    .home.hidden { opacity: 0; pointer-events: none; }
  </style>
</head>
<body>
  <div id="stage" class="stage" title="Click to go to next media (←/→ also work)">
    <div class="stack" aria-live="polite" aria-atomic="true">
      <div id="slideA" class="slide"></div>
      <div id="slideB" class="slide"></div>
    </div>
  </div>
  <div id="info" class="overlay">0 / 0</div>
  <button id="homeBtn" class="home" title="Go to first & randomize others">⌂</button>

  <script>
    const IMAGES = [
      "https://cdn.discordapp.com/attachments/709821851446280234/1428519652685910128/KepRoom.png?ex=68f2cc19&is=68f17a99&hm=239143e7df553953e2ef7f26d47c77b31f87dc1818bb8cd842cf018a5ea676de&",
      "https://static1.e621.net/data/f2/07/f20703a4320cbb3870a2902ae97525e8.webm",
      "https://d.furaffinity.net/art/hungrykep/1751140965/1751140965.hungrykep_ych_animated_bj.gif",
      "https://d.furaffinity.net/art/hungrykep/1753420231/1753420231.hungrykep_image.png",
      "https://d.furaffinity.net/art/hungrykep/1699916788/1699916788.hungrykep_undefined_-_imgur.gif",
      "https://d.furaffinity.net/art/hungrykep/1732498148/1732498148.hungrykep_bar.png",
      "https://d.furaffinity.net/art/hungrykep/1734276288/1734276288.hungrykep_1721339509_hungrykep_img_3265.png",
      "https://d.furaffinity.net/art/hungrykep/1737052169/1737052169.hungrykep_spoiler_img_0040.png",
      "https://d.furaffinity.net/art/hungrykep/1737090781/1737090781.hungrykep_img_9252.png",
      "https://d.furaffinity.net/art/hungrykep/1737052420/1737052420.hungrykep_10don.png",
      "https://d.furaffinity.net/art/hungrykep/1745132955/1745132955.hungrykep_img_3089.png",
      "https://d.furaffinity.net/art/hungrykep/1746907159/1746907159.hungrykep_img_20240220_213944_457_jpeg.jpg",
      "https://d.furaffinity.net/art/hungrykep/1746925910/1746925910.hungrykep_img_2984.gif",
      "https://d.furaffinity.net/art/hungrykep/1751818888/1751818888.hungrykep_img_3085.gif",
      "https://d.furaffinity.net/art/hungrykep/1759260906/1759260906.hungrykep_img-0438.png",
      "https://d.furaffinity.net/art/hungrykep/1752688980/1752688980.hungrykep_img_3445.png",
      "https://d.furaffinity.net/art/hungrykep/1754922193/1754922193.hungrykep_img_3444.png",
      "https://d.furaffinity.net/art/hungrykep/1745245456/1745245456.hungrykep_spoiler_img_8973.png"
    ];

    const info = document.getElementById('info');
    const stage = document.getElementById('stage');
    const slideA = document.getElementById('slideA');
    const slideB = document.getElementById('slideB');
    const homeBtn = document.getElementById('homeBtn');

    let index = 0;
    let front = slideA;
    let back = slideB;

    function updateInfo(){ info.textContent = `${IMAGES.length ? index + 1 : 0} / ${IMAGES.length}`; }

    function toggleHomeButton(){
      if (index === 0) homeBtn.classList.add('hidden');
      else homeBtn.classList.remove('hidden');
    }

    function isVideo(url){ return /\.(webm)(?:$|\?)/i.test(url); }

    function getNaturalSize(el){
      if (!el) return {w:0,h:0};
      if (el.tagName === 'IMG') return { w: el.naturalWidth || 0, h: el.naturalHeight || 0 };
      if (el.tagName === 'VIDEO') return { w: el.videoWidth || 0, h: el.videoHeight || 0 };
      return {w:0,h:0};
    }

    function sizeToViewport(mediaEl){
      const vw = window.innerWidth; const vh = window.innerHeight;
      const {w: nw, h: nh} = getNaturalSize(mediaEl);
      if (!nw || !nh) return;
      const scaleToFit = Math.min(vw / nw, vh / nh);
      const bothSmaller = (nw < vw && nh < vh);
      const scale = bothSmaller ? scaleToFit : Math.min(1, scaleToFit);
      const dispW = Math.round(nw * scale);
      const dispH = Math.round(nh * scale);
      mediaEl.style.width  = dispW + 'px';
      mediaEl.style.height = dispH + 'px';
    }

    function clearSlide(slide){
      const m = slide.querySelector('.media');
      if (m && m.tagName === 'VIDEO') { try { m.pause(); m.src = ''; m.load(); } catch(e){} }
      slide.innerHTML = '';
      slide.classList.remove('is-visible');
    }

    function createMedia(url){
      if (isVideo(url)){
        const v = document.createElement('video');
        v.className = 'media';
        v.playsInline = true; v.muted = true; v.loop = true; v.autoplay = true; v.preload = 'auto';
        v.src = url;
        return v;
      } else {
        const im = document.createElement('img');
        im.className = 'media';
        im.alt = '';
        im.src = url;
        return im;
      }
    }

    function preload(url){ if (isVideo(url)) { const v = document.createElement('video'); v.preload = 'metadata'; v.src = url; } else { const im = new Image(); im.src = url; } }

    function onMediaReady(mediaEl, cb){
      if (mediaEl.tagName === 'IMG'){
        if (mediaEl.complete && mediaEl.naturalWidth) { cb(); }
        else mediaEl.onload = cb;
      } else if (mediaEl.tagName === 'VIDEO'){
        if (mediaEl.readyState >= 1 && mediaEl.videoWidth) { cb(); }
        else mediaEl.onloadedmetadata = cb;
      }
    }

    function showImage(i){
      if (!IMAGES.length) return;
      index = (i + IMAGES.length) % IMAGES.length;
      const nextSrc = IMAGES[index];

      clearSlide(back);
      const media = createMedia(nextSrc);
      back.appendChild(media);

      onMediaReady(media, () => {
        sizeToViewport(media);
        back.classList.add('is-visible');
        front.classList.remove('is-visible');
        const prev = front.querySelector('.media');
        if (prev && prev.tagName === 'VIDEO') { try { prev.pause(); } catch(e){} }
        [front, back] = [back, front];
        updateInfo();
        toggleHomeButton();
        preload(IMAGES[(index + 1) % IMAGES.length]);
      });
    }

    function shuffleTail(arr){
      if (arr.length <= 2) return;
      for (let j = arr.length - 1; j > 1; j--) {
        const k = 1 + Math.floor(Math.random() * j);
        [arr[j], arr[k]] = [arr[k], arr[j]];
      }
    }

    homeBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      shuffleTail(IMAGES);
      showImage(0);
    });

    stage.addEventListener('click', () => showImage(index + 1));
    window.addEventListener('keydown', (e) => {
      if (!IMAGES.length) return;
      if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); showImage(index + 1); }
      else if (e.key === 'ArrowLeft') { e.preventDefault(); showImage(index - 1); }
    });

    window.addEventListener('resize', () => {
      const mA = front.querySelector('.media');
      const mB = back.querySelector('.media');
      if (mA) sizeToViewport(mA);
      if (mB) sizeToViewport(mB);
    });

    (function init(){
      if (!IMAGES.length) return;
      shuffleTail(IMAGES); // randomize all but first at start
      updateInfo();
      const first = IMAGES[0];
      const media = createMedia(first);
      front.appendChild(media);
      onMediaReady(media, () => { sizeToViewport(media); front.classList.add('is-visible'); updateInfo(); toggleHomeButton(); preload(IMAGES[1 % IMAGES.length]); });
    })();
  </script>
</body>
</html>
